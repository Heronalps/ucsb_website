<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Server-side Caching and Deploying on AWS</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
      
      <link rel="stylesheet" href="theme/css/custom.css">
      
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    
    <!-- /Javascripts -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67332703-1', 'auto');
      ga('send', 'pageview');
    </script>
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide title slide-1">
          <div class="inner">
            
            <header><h1>Server-side Caching and Deploying on AWS</h1></header>
            
            
            <section><p><strong>CS290B</strong></p>
<p>Dr. Bryce Boe</p>
<p>October 20, 2015</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              1/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-2">
          <div class="inner">
            
            <header><h1>Today's Agenda</h1></header>
            
            
            <section><ul>
<li>High Availability Review</li>
<li>Client-Side Caching Review</li>
<li>Server-side Caching</li>
<li>Deploying on Amazon Web Services (AWS)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              2/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-3">
          <div class="inner">
            
            <header><h1>High Availability Review</h1></header>
            
            
            <section><p><img alt="High Availability in Two Sites" src="img/dual_site_availability.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              3/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-4">
          <div class="inner">
            
            <header><h1>Client-side Caching Review</h1></header>
            
            
            <section><p><img alt="Defining optimal Cache-Control policy" src="img/http-cache-decision-tree.png" /></p>
<p>Source: <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching">https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              4/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-5">
          <div class="inner">
            
            <header><h1>Client-side Caching in Rails</h1></header>
            
            
            <section><ul>
<li>
<p>Use <code>stale?</code> if you want to conditionally execute a section of code only
  if the client doesn't have a cached version.</p>
</li>
<li>
<p>Use <code>fresh_when</code> if you only want to use/set the cache headers.</p>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              5/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-6">
          <div class="inner">
            
            <header><h1>Goals for Today</h1></header>
            
            
            <section><h2>After today you should understand...</h2>
<ul>
<li>why server-side caching exists</li>
<li>what options you have when using server-side caching</li>
<li>how to use server-side caching in your projects</li>
<li>how to deploy on AWS using CloudFormation</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              6/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-7">
          <div class="inner">
            
            <header><h1>Caching HTTP Responses: Motivation</h1></header>
            
            
            <section><p>A single web server process repeatedly responds to HTTP requests from a variety
of clients.</p>
<p>Responding to each request requires computation and/or I/O to be
performed, both of which can be expensive.</p>
<p>In practice, there is a significant amount of similarity between HTTP
responses.</p>
<p>In the client-side caching lecture we looked at optimizing scenarios where
requests for the same resource would result in an identical response.</p>
<p>In this lecture we will look at optimizing scenarios where repeated responses
are not identical, but similar.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              7/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-8">
          <div class="inner">
            
            <header><h1>Caching HTTP Responses</h1></header>
            
            
            <section><blockquote>
<p>With respect to HTTP responses for a single web service, which parts of a
response are similar to responses for other resources?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              8/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-9">
          <div class="inner">
            
            <header><h1>Caching HTTP Responses</h1></header>
            
            
            <section><blockquote>
<p>With respect to HTTP responses for a single web service, which parts of a
response are similar to responses for other resources?</p>
</blockquote>
<ul>
<li>View fragments</li>
<li>Rarely modified ORM objects</li>
<li>Expensive to compute data</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              9/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-10">
          <div class="inner">
            
            <header><h1>View Fragments</h1></header>
            
            
            <section><p>View fragments are items that are similar across pages such as the header,
footer, sidebar, or even an item listing that may appear in multiple locations
(product listings, search results, product suggestions).</p>
<p>Sidebar Fragment (shown on all cs290.com pages)</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-3 hidden-xs&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar well&quot;</span><span class="nt">&gt;</span>
    Scalable Internet Services, CS290B, Fall 2015
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar well&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;course-information&quot;</span><span class="nt">&gt;</span>Course Information<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;instructor&quot;</span><span class="nt">&gt;</span>Instructor<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://cs.ucsb.edu/~bboe&quot;</span><span class="nt">&gt;</span>Dr. Bryce Boe<span class="nt">&lt;/a&gt;</span>

    <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;lecture&quot;</span><span class="nt">&gt;</span>Lecture<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;p&gt;</span>Tuesday and Thursday<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
       3:00pm – 4:50pm<span class="nt">&lt;/p&gt;</span>

    ...

  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              10/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-11">
          <div class="inner">
            
            <header><h1>Rarely Modified ORM Objects</h1></header>
            
            
            <section><ul>
<li>User permissions</li>
<li>Configuration options</li>
<li>Product details (on a shopping site)</li>
<li>In general, any database-backed data that seldom changes</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              11/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-12">
          <div class="inner">
            
            <header><h1>Expensive to Compute Data</h1></header>
            
            
            <section><p>Expensive to compute data is exactly what the name suggests. Expensive may mean
it takes a significant amount of time to compute, or maybe it is best suited
for a background worker due to hardware constraints on the application servers.</p>
<h2>Examples</h2>
<ul>
<li>Total account balance on Mint</li>
<li>Monthly account summary on Google</li>
<li>The complete diff between two commits on GitHub</li>
<li>The list of suggested contacts on LinkedIn</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              12/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-13">
          <div class="inner">
            
            <header><h1>Semi-Expensive Operations</h1></header>
            
            
            <section><p>View fragments are produced by extensive string manipulation. In ruby, many
string manipulations with portions loaded from disk can result in a significant
amount of time.</p>
<p>Every query to the database utilizes its resources. Optimizing for similar
queries can minimize the chance of a database bottleneck.</p>
<blockquote>
<p>Assuming we want to keep previously computed results around between requests,
how can we do it?</p>
<p>Where can we store the cached results?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              13/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-14">
          <div class="inner">
            
            <header><h1>Storing Cached Results</h1></header>
            
            
            <section><p>Option 1: In memory on the application server</p>
<p>Option 2: On the file system</p>
<p>Option 3: In memory on another machine</p>
<p>Now, let's look into each of these options. But first a look at latency.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              14/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-15">
          <div class="inner">
            
            <header><h1>Latency Numbers (ns and μs)</h1></header>
            
            
            <section><p><img alt="Latency Numbers Every Programmer Should Know" src="img/latency_1_2015.png" /></p>
<p>Source: http://www.eecs.berkeley.edu/~rcs/research/interactive_latency.html</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              15/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-16">
          <div class="inner">
            
            <header><h1>Latency Numbers (μs and ms)</h1></header>
            
            
            <section><p><img alt="Latency Numbers Every Programmer Should Know" src="img/latency_2_2015.png" /></p>
<p>Source: http://www.eecs.berkeley.edu/~rcs/research/interactive_latency.html</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              16/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-17">
          <div class="inner">
            
            <header><h1>Latency Numbers for Caching</h1></header>
            
            
            <section><ul>
<li>Storing in memory and reading later is fast<ul>
<li>Random reads from memory is &lt; 0.1μs</li>
<li>Reading 1MB is 9μs</li>
</ul>
</li>
<li>Storing on disk is slow without SSD (solid state drive):<ul>
<li>Disk seek is 4000μs</li>
<li>Subsequent sequential read of 1MB is 2000μs</li>
</ul>
</li>
<li>Storing on disk with SSD is much more reasonable<ul>
<li>Random read is 16μs</li>
<li>Sequential read of 1MB is 156μs</li>
</ul>
</li>
<li>Storing on another machine is reasonable<ul>
<li>Round trip within data center is 500μs</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              17/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-18">
          <div class="inner">
            
            <header><h1>Latency Numbers Summary</h1></header>
            
            
            <section><h2>Summary</h2>
<ul>
<li>In memory: tens of μs</li>
<li>On SSD: hundreds of μs</li>
<li>On magnetic disk: thousands of μs</li>
<li>On remote machine: add hundreds of μs</li>
</ul>
<h2>Conclusions</h2>
<ul>
<li>Always use SSD over magnetic storage</li>
<li>Memory &gt; SSD &gt; Remote</li>
</ul>
<blockquote>
<p>Are these conclusions always true?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              18/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-19">
          <div class="inner">
            
            <header><h1>Caching Locations</h1></header>
            
            
            <section><blockquote>
<p>What effect on the cache hit rate does each of these designs have?</p>
</blockquote>
<ul>
<li>In memory: cache per process</li>
<li>On SSD: Cache per machine</li>
<li>On remote machine: Cache per application server pool (cluster)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              19/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-20">
          <div class="inner">
            
            <header><h1>Caching Location Trade-offs</h1></header>
            
            
            <section><ul>
<li>In memory<ul>
<li>highest performance</li>
<li>lowest hit rate</li>
</ul>
</li>
<li>On SSD<ul>
<li>lower performance</li>
<li>higher hit rate</li>
</ul>
</li>
<li>On remove machine<ul>
<li>lowest performance</li>
<li>highest hit rate</li>
</ul>
</li>
</ul>
<p>There is no silver bullet.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              20/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-21">
          <div class="inner">
            
            <header><h1>Caching Trade-offs</h1></header>
            
            
            <section><blockquote>
<p>How will each of the following affect system performance:</p>
</blockquote>
<ul>
<li>Number of processes per machine</li>
<li>Concurrency model of application server</li>
<li>Number of machines per cluster</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              21/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-22">
          <div class="inner">
            
            <header><h1>Memcached</h1></header>
            
            
            <section><p><strong>memcached</strong> is a commonly used remote cache server. It...</p>
<ul>
<li>keeps a cache in memory</li>
<li>provides a simple TCP protocol to return responses to look up requests</li>
<li>is a distributed key-value store<ul>
<li>keys can be up to 250 bytes</li>
<li>values can be up to 1MB</li>
<li>scales horizontally</li>
</ul>
</li>
<li>uses a simple LRU (least recently used) to make space for new items when full</li>
<li>performs all operations in constant time</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              22/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-23">
          <div class="inner">
            
            <header><h1>Server-side Caching in Rails</h1></header>
            
            
            <section><p>Rails provides excellent support for server-side caching.</p>
<p>The three primary interfaces to caching in rails are:</p>
<ul>
<li>HTTP caching</li>
<li>Fragment caching</li>
<li>Low level caching</li>
</ul>
<p>We already covered HTTP caching. Today we'll discuss the latter two.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              23/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-24">
          <div class="inner">
            
            <header><h1>Enabling Caching in Rails</h1></header>
            
            
            <section><p>By default, caching is disabled in development and test modes, and enabled only
in production mode.</p>
<p>If you want to enable caching in development mode you must make the following
change to your Rails environment:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">action_controller</span><span class="o">.</span><span class="n">perform_caching</span> <span class="o">=</span> <span class="kp">true</span>
</pre></div>
</td></tr></table>
<p>Rails can be configured to store cached data in a few different places:</p>
<ul>
<li>In memory</li>
<li>On a <em>local</em> file system</li>
<li>In a remote in-memory store</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              24/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-25">
          <div class="inner">
            
            <header><h1>Rails Cache Stores</h1></header>
            
            
            <section><h2>ActiveSupport::Cache::MemoryStore</h2>
<ul>
<li>Cached data is stored in memory, in the same address space as the ruby
  process.</li>
<li>Defaults to 32MB, configurable</li>
</ul>
<h2>ActiveSupport::Cache::FileStore</h2>
<ul>
<li>Cached data is stored on the <em>local</em> file system.</li>
<li>Can configure the location of the storage in the Rails environment:<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">cache_store</span> <span class="o">=</span> <span class="ss">:file_store</span><span class="p">,</span> <span class="s1">&#39;/path/to/cache/&#39;</span>
</pre></div>
</td></tr></table>
</li>
</ul>
<h2>ActiveSupport::Cache::MemcacheStore</h2>
<ul>
<li>Cached data is stored in memory on another machine (could also be local).</li>
<li>Can configure the location of the server in the Rails environment:<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">config</span><span class="o">.</span><span class="n">cache_store</span> <span class="o">=</span> <span class="ss">:mem_cache_store</span><span class="p">,</span> <span class="s1">&#39;cache-1.example.com&#39;</span>
</pre></div>
</td></tr></table>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              25/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-26">
          <div class="inner">
            
            <header><h1>Rails: Fragment Caching</h1></header>
            
            
            <section><p>Fragment caching caches a portion of a rendered view for reuse on future
requests.</p>
<p>Let's look at fragment caching in the context of the demo app.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              26/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-27">
          <div class="inner">
            
            <header><h1>Fragment Caching Submission Partials</h1></header>
            
            
            <section><p><img alt="Submissions Index View" src="img/demo_submissions_index.png" /></p>
<p>We can cache each submission listing.</p>
<p>With that done, then regardless of any other changes on the page, we can
re-render the submission view for all submissions that haven't been updated.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              27/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-28">
          <div class="inner">
            
            <header><h1>Submission Listing (without cache)</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="vi">@submissions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">submission</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">submission</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">submission</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> comments&quot;</span><span class="p">,</span>
                  <span class="n">submission</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">&#39;btn btn-primary btn-xs&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/td&gt;</span>
<span class="x">  &lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              28/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-29">
          <div class="inner">
            
            <header><h1>Submission Listing (with cache)</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="vi">@submissions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">submission</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  </span><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="n">cache_key_for_submission</span><span class="p">(</span><span class="n">submission</span><span class="p">))</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">  &lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="n">submission</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">submission</span><span class="o">.</span><span class="n">url</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">submission</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span>
<span class="x">      </span><span class="cp">&lt;%=</span> <span class="n">link_to</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">submission</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> comments&quot;</span><span class="p">,</span>
                  <span class="n">submission</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s1">&#39;btn btn-primary btn-xs&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;/td&gt;</span>
<span class="x">  &lt;/tr&gt;</span>

<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              29/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-30">
          <div class="inner">
            
            <header><h1>Choosing a Cache Key</h1></header>
            
            
            <section><blockquote>
<p>How should we choose a cache key?</p>
</blockquote>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">SubmissionHelper</span>
  <span class="k">def</span> <span class="nf">cache_key_for_submission</span><span class="p">(</span><span class="n">submission</span><span class="p">)</span>
    <span class="s2">&quot;submission/</span><span class="si">#{</span><span class="n">submission</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
<blockquote>
<p>What are the weaknesses with the above approach?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              30/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-31">
          <div class="inner">
            
            <header><h1>Choosing a Cache Key (answer)</h1></header>
            
            
            <section><blockquote>
<p>How should we choose a cache key?</p>
</blockquote>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">SubmissionHelper</span>
  <span class="k">def</span> <span class="nf">cache_key_for_submission</span><span class="p">(</span><span class="n">submission</span><span class="p">)</span>
    <span class="s2">&quot;submission/</span><span class="si">#{</span><span class="n">submission</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
<blockquote>
<p>What are the weaknesses with the above approach?</p>
</blockquote>
<ul>
<li>Invalidation will need to be explicit as the submission ID will rarely, if
  never, be updated for an object.</li>
<li>Explicitly invalidating cache items can easily make a mess of the code.</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              31/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-32">
          <div class="inner">
            
            <header><h1>Choosing a Better Cache Key</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">SubmissionHelper</span>
  <span class="k">def</span> <span class="nf">cache_key_for_submission</span><span class="p">(</span><span class="nb">sub</span><span class="p">)</span>
    <span class="s2">&quot;submission/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">updated_at</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
<p>With the above, a submission's fragment cache is invalidated anytime the
submission is updated (<code>updated_at</code> is always updated), or when the number of
comments associated with the submission changes.</p>
<p><em>Note</em>: An Active Record model can be used directly as the key. It calls an
over-writable method <code>cache_key</code> on the model. By default that method returns a
key that "includes the model name, the id and finally the updated_at
timestamp".</p>
<p>Reference:
<a href="http://guides.rubyonrails.org/caching_with_rails.html#fragment-caching">http://guides.rubyonrails.org/caching_with_rails.html#fragment-caching</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              32/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-33">
          <div class="inner">
            
            <header><h1>More Fragment Caching</h1></header>
            
            
            <section><p><img alt="Submissions Index View" src="img/demo_submissions_index.png" /></p>
<p>Now we are caching a fragment for each submission.</p>
<blockquote>
<p>What else can we cache?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              33/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-34">
          <div class="inner">
            
            <header><h1>More Fragment Caching</h1></header>
            
            
            <section><p><img alt="Submissions Index View" src="img/demo_submissions_index.png" /></p>
<p>Now we are caching a fragment for each submission.</p>
<blockquote>
<p>What else can we cache?</p>
</blockquote>
<p>We can cache the entire submission listing!</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              34/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-35">
          <div class="inner">
            
            <header><h1>Community Listing (without cache)</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="x">&lt;h3&gt;Submissions&lt;/h3&gt;</span>
<span class="x">&lt;table class=&quot;table&quot;&gt;</span>
<span class="x">  &lt;thead&gt;</span>
<span class="x">    &lt;tr&gt;</span>
<span class="x">      &lt;th&gt;Title&lt;/th&gt;</span>
<span class="x">      &lt;th&gt;Url&lt;/th&gt;</span>
<span class="x">      &lt;th&gt;Community&lt;/th&gt;</span>
<span class="x">      &lt;th colspan=&quot;3&quot;&gt;&lt;/th&gt;</span>
<span class="x">    &lt;/tr&gt;</span>
<span class="x">  &lt;/thead&gt;</span>

<span class="x">  &lt;tbody&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="vi">@submissions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">submission</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"> ... </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/tbody&gt;</span>
<span class="x">&lt;/table&gt;</span>

<span class="x">...</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              35/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-36">
          <div class="inner">
            
            <header><h1>Community Listing (with cache)</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="n">cache_key_for_submission_table</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;h3&gt;Submissions&lt;/h3&gt;</span>
<span class="x">&lt;table class=&quot;table&quot;&gt;</span>
<span class="x">  &lt;thead&gt;</span>
<span class="x">    &lt;tr&gt;...&lt;/tr&gt;</span>
<span class="x">  &lt;/thead&gt;</span>

<span class="x">  &lt;tbody&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="vi">@submissions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">submission</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"> ... </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/tbody&gt;</span>
<span class="x">&lt;/table&gt;</span>

<span class="x">...</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              36/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-37">
          <div class="inner">
            
            <header><h1>cache_key_for_submission_table</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">module</span> <span class="nn">SubmissionHelper</span>
  <span class="k">def</span> <span class="nf">cache_key_for_submission</span><span class="p">(</span><span class="nb">sub</span><span class="p">)</span>
    <span class="s2">&quot;submission/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">updated_at</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">sub</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">cache_key_for_submission_table</span>
    <span class="p">(</span><span class="s2">&quot;submission_table/</span><span class="si">#{</span><span class="no">Submission</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span><span class="si">}</span><span class="s2">/&quot;</span>
     <span class="o">+</span> <span class="no">Comment</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="ss">:updated_at</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
<p>This technique of nesting cache fragments is known as <strong>Russian Doll Caching</strong>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              37/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-38">
          <div class="inner">
            
            <header><h1>Low-level Rails Caching</h1></header>
            
            
            <section><p>You can use the same built-in mechanisms to manually cache anything:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">competing_price</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">/competing_price&quot;</span><span class="p">,</span>
                      <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">12</span><span class="o">.</span><span class="n">hours</span><span class="p">)</span> <span class="k">do</span>
      <span class="no">Competitor</span><span class="o">::</span><span class="no">API</span><span class="o">.</span><span class="n">find_price</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              38/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-39">
          <div class="inner">
            
            <header><h1>Performance Comparison</h1></header>
            
            
            <section><p>Let's compare the performance of the demo app with and without caching.</p>
<p>The subsequent graphs were generated using Tsung against a deployment of the
<code>master</code> branch (without caching) and against a deployment of the
<code>server_side_caching</code> branch (with server-side caching) using the default rails
caching mechanism (memory).</p>
<p>The <code>master</code> branch intentionally includes no optimizations.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              39/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-40">
          <div class="inner">
            
            <header><h1>Caching Test: Simulated Users</h1></header>
            
            
            <section><p>We will use an m3-medium instance with the usual workload deployed using
passenger as an NGINX module.</p>
<p>Using Tsung (erlang-based test framework) we will simulate multiple users
visiting the Demo App web service. Each user will:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre>Visit the homepage (/)
  Wait randomly between 0 and 2 seconds
Request community creation form
  Wait randomly between 0 and 2 seconds
Submit new community form
Request new link submission form
  Wait randomly between 0 and 2 seconds
Submit new link submission form
  Wait randomly between 0 and 2 seconds
Delete the link
  Wait randomly between 0 and 2 seconds
Delete the community
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              40/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-41">
          <div class="inner">
            
            <header><h1>Caching Test: Phases</h1></header>
            
            
            <section><p>This time we have six phases of testing each lasting 60 seconds:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre>   (0-59s) Every second a new simulated user arrives
 (60-119s) Every second 1.5 new simulated users arrive
(120-179s) Every second 2 new simulated users arrive
(180-239s) Every second 4 new simulated users arrive
(240-299s) Every second 6 new simulated users arrive
(300-359s) Every second 10 new simulated users arrive
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              41/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-42">
          <div class="inner">
            
            <header><h1>Performance without Caching</h1></header>
            
            
            <section><p>The application struggles to handle a single user arriving each second.</p>
<p><img alt="Performance without caching" src="img/performance_no_caching.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              42/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-43">
          <div class="inner">
            
            <header><h1>Performance with Caching</h1></header>
            
            
            <section><p>With server-side caching implemented, the server can easily handle up to two
new users a second.</p>
<p><img alt="Performance with caching" src="img/performance_server_cache.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              43/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-44">
          <div class="inner">
            
            <header><h1>Deploying to AWS</h1></header>
            
            
            <section><p>Now that you all have a start to your rails application on Github, it is time
to learn how to deploy to AWS (Amazon Web Service).</p>
<p>Amazon provides a tool called CloudFormation that we will be using to create
various deployments.</p>
<p>The various templates can be found at:
<a href="https://github.com/scalableinternetservices/utils">https://github.com/scalableinternetservices/utils</a>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              44/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-45">
          <div class="inner">
            
            <header><h1>AWS Warnings and Rules</h1></header>
            
            
            <section><p>The resources we have been granted via the <em>AWS in Education Grant award</em> are
limited for this class. Please:</p>
<ul>
<li>Only launch instances when you are ready to test something.</li>
<li>Shutdown instances immediately when testing is done.</li>
<li>For deployment testing please only use the single-instance <code>t2.micro</code>
  instances (once I get those working; <code>t1.micro</code> until then).</li>
<li>For vertical scaling tests, always start with the smallest instance type and
  work your way up in order to minimize the larger instance launch time.</li>
<li>For horizontal scaling tests, try to consistently use the smallest instance
  type.</li>
<li>Do not use any of the <code>micro</code> instances when performing scalability
  tests they have a quota system that can affect results).</li>
</ul>
<p><strong>In general</strong>: When it doubt, please ask.</p>
<p>In order to enforce minimal instance usage, all instances will be automatically
terminated after 4 hours. If you want to leave an always on <code>t2.micro</code> instance
running please let me know and I can exclude it.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              45/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-46">
          <div class="inner">
            
            <header><h1>AWS Instances and Data</h1></header>
            
            
            <section><p>Because instances can only live for 4 hours it is important to:</p>
<ul>
<li>Fetch any important data on the instances as soon as available (e.g., test
  results)</li>
<li>Quickly load large amounts of testing data (test this process on smaller
  instances)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              46/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-47">
          <div class="inner">
            
            <header><h1>Signing into AWS</h1></header>
            
            
            <section><p>This evening I will send a piazza message to each team containing your team's
credentials to login to the AWS interface.</p>
<p>To login visit:
<a href="https://bboe.signin.aws.amazon.com/console">https://bboe.signin.aws.amazon.com/console</a></p>
<p><img alt="bboe AWS Sign-in" src="img/aws_signin.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              47/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-48">
          <div class="inner">
            
            <header><h1>North Virginia Region</h1></header>
            
            
            <section><p>Ensure that the <strong>N. Virginia</strong> (us-east-1) region is selected in the upper
right.</p>
<p><img alt="AWS N. Virginia" src="img/aws_region.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              48/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-49">
          <div class="inner">
            
            <header><h1>CloudFormation</h1></header>
            
            
            <section><p>Click the <em>CloudFormation</em> service link in the middle column under the
<em>Management Tools</em> section.</p>
<p><img alt="AWS CloudFormation" src="img/aws_cloud_formation.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              49/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-50">
          <div class="inner">
            
            <header><h1>CloudFormation (Subsequent Visits)</h1></header>
            
            
            <section><p>On subsequent visits <strong>CloudFormation</strong> will appear in your
<em>Services/History</em>. Also note that the link is the fourth one under the <strong>All
AWS Services</strong> section.</p>
<p><img alt="AWS CloudFormation History" src="img/aws_cloud_formation_history.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              50/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-51">
          <div class="inner">
            
            <header><h1>Stack Listing</h1></header>
            
            
            <section><p>Observe the various stacks that are launched.</p>
<p>Click the blue <strong>Create Stack</strong> button to create a new stack.</p>
<p><img alt="AWS CloudFormation View" src="img/aws_cloud_formation_view.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              51/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-52">
          <div class="inner">
            
            <header><h1>Find a Template to Launch</h1></header>
            
            
            <section><p>Copy the URL for the desired UCSB CloudFormation template from the list at:
<a href="https://github.com/scalableinternetservices/utils/">https://github.com/scalableinternetservices/utils/</a></p>
<p>For now, the only available template is the Single Instance UCSB WEBrick
template at:
<a href="https://cs290b.s3.amazonaws.com/SingleWEBrick.json">https://cs290b.s3.amazonaws.com/SingleWEBrick.json</a></p>
<p><img alt="Template URLs" src="img/template_urls.png" /></p>
<p><strong>Note</strong>: I will soon add the other URLs. I will also likely remove the WEBrick
template altogether. At that point the SingleInstance PUMA template should be
used for deployment testing.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              52/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-53">
          <div class="inner">
            
            <header><h1>Specifying a CloudFormation Template</h1></header>
            
            
            <section><p>Paste the URL of the template into the <em>Specify an Amazon S3 template URL</em>
field, and click the blue<strong>Next</strong> button when ready.</p>
<p><img alt="CloudFormation Template" src="img/aws_cloud_formation_template.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              53/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-54">
          <div class="inner">
            
            <header><h1>Specifying CloudFormation Parameters</h1></header>
            
            
            <section><ol>
<li>Provide a stack name. Your stack name start exactly with your TeamName (case
   sensitive). Following your stack name you should provide your name and maybe
   the purpose of the stack, e.g. <code>demo-bboe-4apps</code>, and <code>demo-bboe-tsung</code>.</li>
<li>Select the application server EC2 instance type. For now use only <code>t1.micro</code>
   until that option disappears then use <code>t2.micro</code>.</li>
<li>Specify the git branch of your application server to deploy.</li>
<li>Select your team name.</li>
</ol>
<p><img alt="CloudFormation parameters" src="img/aws_cloud_formation_parameters.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              54/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-55">
          <div class="inner">
            
            <header><h1>Disable Rollback on Failure</h1></header>
            
            
            <section><p>By default if a CloudFormation stack fails to deploy it will auto-rollback. In
essence, this will prevent you from logging into the instance to see why it
failed.</p>
<p>We want to disable rollback on failure.</p>
<ol>
<li>
<p>Expand the <em>Advanced</em> section</p>
<p><img alt="CloudFormation Advanced" src="img/aws_cloud_formation_advanced.png" /></p>
</li>
<li>
<p>Select <strong>No</strong> for the "Rollback on failure" option.</p>
<p><img alt="CloudFormation Rollback" src="img/aws_cloud_formation_rollback.png" /></p>
</li>
<li>
<p>Deploy your stack!</p>
</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              55/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-56">
          <div class="inner">
            
            <header><h1>Accessing Your Server</h1></header>
            
            
            <section><p>On successful stack creation, select the <strong>Outputs</strong> tab in the lower left.</p>
<p><img alt="CloudFormation Outputs" src="img/aws_cloud_formation_outputs.png" /></p>
<p>The SSH output provides the SSH connect string you can use in order to SSH into
the machine.</p>
<p>You will either need to run this command from the same directory that contains
your <code>TEAMNAME.pem</code> file, or you can modify the <code>-i TEAMNAME.pem</code> parameter to
provide an appropriate path to your <code>pem</code> file.</p>
<p>The URL output provides a link to access your deployment running in
production mode.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              56/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-57">
          <div class="inner">
            
            <header><h1>Deleting Your Stack</h1></header>
            
            
            <section><p>When you are done with your instance delete your stack.</p>
<p><img alt="CloudFormation Delete Stack" src="img/aws_cloud_formation_delete_stack.png" /></p>
<p><strong>Be careful!</strong> While you will not be able to delete the stacks of other teams,
you are able to delete your teammates' stacks. Double check that you are
deleting the right stacks.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              57/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-58">
          <div class="inner">
            
            <header><h1>Stack Helper Files</h1></header>
            
            
            <section><p>There are two files that you may want to add to your repository:</p>
<h2>.ec2_initialize</h2>
<p>This script runs before <code>bundle install</code> is run on the application
server(s). It is useful if you need to install any packages (only use <code>sudo</code> if
necessary)</p>
<pre><code>sudo yum install -y ImageMagick
</code></pre>
<h2>.rails_initialize</h2>
<p>This script runs after <code>rake db:create db:migrate</code> is run on the application
server(s). One usefulness is to use it to pre-populate your database, i.e.:</p>
<pre><code>rake db:seed
</code></pre>
<p>Both files described in more detail at:
<a href="https://github.com/scalableinternetservices/utils/#running-your-own-instance-configuration">https://github.com/scalableinternetservices/utils/#running-your-own-instance-configuration</a></p>
<p>See the Demo app files here:
<a href="https://github.com/scalableinternetservices/demo">https://github.com/scalableinternetservices/demo</a></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              58/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-59">
          <div class="inner">
            
            <header><h1>Failed Stacks</h1></header>
            
            
            <section><p>The launching of your stack can fail for a number of reasons:</p>
<ul>
<li>Application failed to launch (you do have automated testing configured,
  right?)</li>
<li>Missing gem</li>
<li>Missing gem dependency (package to install via <code>sudo yum install -y ...</code>)</li>
<li>Stack creation Timeout</li>
</ul>
<p>Assuming you disabled "Rollback on Failure" then you will be able to SSH into
the instance to see what went wrong.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              59/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-60">
          <div class="inner">
            
            <header><h1>Finding the EC2 Instance</h1></header>
            
            
            <section><p>When a stack failure occurs, you will not receive an output containing the SSH
command(s). You will need to manually find the EC2 instance to log into.</p>
<ol>
<li>Note the failed stack name. Let's assume it is <code>demo-bboe</code></li>
<li>Browse to the EC2 console:
   <a href="https://console.aws.amazon.com/ec2/v2/home?region=us-east-1">https://console.aws.amazon.com/ec2/v2/home?region=us-east-1</a></li>
<li>In the filter bar type in your stack name: <code>demo-bboe</code>.</li>
<li>Select the instance and hit the <strong>Connect</strong> button to obtain the connect
string.</li>
</ol>
<p><img alt="EC2 Filter" src="img/aws_ec2_filter.png" /></p>
<p><strong>Note</strong>: If there are multiple results and you're not on a multi-machine stack
you will need to manually inspect each instance's tags to find the right one.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              60/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-61">
          <div class="inner">
            
            <header><h1>Inspecting the Instances' Log Files</h1></header>
            
            
            <section><p>There are a few files of interest on the app server instances:</p>
<ul>
<li>/var/log/cfn_init-cmd.log</li>
<li>/var/log/cfn_init.log</li>
<li>/var/log/cloud-init.log</li>
<li>/var/log/cloud-init-output.log **</li>
</ul>
<p>Use <em>less</em>, <em>tail</em>, <em>cat</em>, or your other favorite program to inspect these logs
to check for failures.</p>
<p>** <strong>cloud-init-output.log</strong> will most likely contain the errors you are
   looking for.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              61/62
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 08_server_side_caching_and_deploying_on_aws.md -->
      <div class="slide-wrapper">
        <div class="slide slide-62">
          <div class="inner">
            
            <header><h1>By End of Thursday's Lab</h1></header>
            
            
            <section><p>Demonstrate that you can successfully deploy your application to AWS.</p>
<p>Bonus (virtual) points for any teams that demo using AWS on Thursday.</p>
<p><strong>Note</strong>: All teams will be expected to demo on AWS for all following labs.</p>
<p>Credentials for AWS access will be sent this evening via Piazza.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="08_server_side_caching_and_deploying_on_aws.md">08_server_side_caching_and_deploying_on_aws.md</a>
            </aside>
            
            <aside class="page_number">
              62/62
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Server-side Caching and Deploying on AWS</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">Today's Agenda</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">High Availability Review</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Client-side Caching Review</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Client-side Caching in Rails</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Goals for Today</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Caching HTTP Responses: Motivation</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Caching HTTP Responses</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">Caching HTTP Responses</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">View Fragments</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Rarely Modified ORM Objects</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Expensive to Compute Data</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Semi-Expensive Operations</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Storing Cached Results</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Latency Numbers (ns and μs)</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">Latency Numbers (μs and ms)</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">Latency Numbers for Caching</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">Latency Numbers Summary</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">Caching Locations</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Caching Location Trade-offs</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">Caching Trade-offs</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">Memcached</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">Server-side Caching in Rails</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">Enabling Caching in Rails</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">Rails Cache Stores</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">Rails: Fragment Caching</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">Fragment Caching Submission Partials</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">Submission Listing (without cache)</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">Submission Listing (with cache)</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">Choosing a Cache Key</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">Choosing a Cache Key (answer)</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">Choosing a Better Cache Key</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">More Fragment Caching</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide34">More Fragment Caching</a></th>
        <td><a href="#slide34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide35">Community Listing (without cache)</a></th>
        <td><a href="#slide35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide36">Community Listing (with cache)</a></th>
        <td><a href="#slide36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide37">cache_key_for_submission_table</a></th>
        <td><a href="#slide37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide38">Low-level Rails Caching</a></th>
        <td><a href="#slide38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide39">Performance Comparison</a></th>
        <td><a href="#slide39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide40">Caching Test: Simulated Users</a></th>
        <td><a href="#slide40">40</a></td>
      </tr>
      
      
      <tr id="toc-row-41">
        <th><a href="#slide41">Caching Test: Phases</a></th>
        <td><a href="#slide41">41</a></td>
      </tr>
      
      
      <tr id="toc-row-42">
        <th><a href="#slide42">Performance without Caching</a></th>
        <td><a href="#slide42">42</a></td>
      </tr>
      
      
      <tr id="toc-row-43">
        <th><a href="#slide43">Performance with Caching</a></th>
        <td><a href="#slide43">43</a></td>
      </tr>
      
      
      <tr id="toc-row-44">
        <th><a href="#slide44">Deploying to AWS</a></th>
        <td><a href="#slide44">44</a></td>
      </tr>
      
      
      <tr id="toc-row-45">
        <th><a href="#slide45">AWS Warnings and Rules</a></th>
        <td><a href="#slide45">45</a></td>
      </tr>
      
      
      <tr id="toc-row-46">
        <th><a href="#slide46">AWS Instances and Data</a></th>
        <td><a href="#slide46">46</a></td>
      </tr>
      
      
      <tr id="toc-row-47">
        <th><a href="#slide47">Signing into AWS</a></th>
        <td><a href="#slide47">47</a></td>
      </tr>
      
      
      <tr id="toc-row-48">
        <th><a href="#slide48">North Virginia Region</a></th>
        <td><a href="#slide48">48</a></td>
      </tr>
      
      
      <tr id="toc-row-49">
        <th><a href="#slide49">CloudFormation</a></th>
        <td><a href="#slide49">49</a></td>
      </tr>
      
      
      <tr id="toc-row-50">
        <th><a href="#slide50">CloudFormation (Subsequent Visits)</a></th>
        <td><a href="#slide50">50</a></td>
      </tr>
      
      
      <tr id="toc-row-51">
        <th><a href="#slide51">Stack Listing</a></th>
        <td><a href="#slide51">51</a></td>
      </tr>
      
      
      <tr id="toc-row-52">
        <th><a href="#slide52">Find a Template to Launch</a></th>
        <td><a href="#slide52">52</a></td>
      </tr>
      
      
      <tr id="toc-row-53">
        <th><a href="#slide53">Specifying a CloudFormation Template</a></th>
        <td><a href="#slide53">53</a></td>
      </tr>
      
      
      <tr id="toc-row-54">
        <th><a href="#slide54">Specifying CloudFormation Parameters</a></th>
        <td><a href="#slide54">54</a></td>
      </tr>
      
      
      <tr id="toc-row-55">
        <th><a href="#slide55">Disable Rollback on Failure</a></th>
        <td><a href="#slide55">55</a></td>
      </tr>
      
      
      <tr id="toc-row-56">
        <th><a href="#slide56">Accessing Your Server</a></th>
        <td><a href="#slide56">56</a></td>
      </tr>
      
      
      <tr id="toc-row-57">
        <th><a href="#slide57">Deleting Your Stack</a></th>
        <td><a href="#slide57">57</a></td>
      </tr>
      
      
      <tr id="toc-row-58">
        <th><a href="#slide58">Stack Helper Files</a></th>
        <td><a href="#slide58">58</a></td>
      </tr>
      
      
      <tr id="toc-row-59">
        <th><a href="#slide59">Failed Stacks</a></th>
        <td><a href="#slide59">59</a></td>
      </tr>
      
      
      <tr id="toc-row-60">
        <th><a href="#slide60">Finding the EC2 Instance</a></th>
        <td><a href="#slide60">60</a></td>
      </tr>
      
      
      <tr id="toc-row-61">
        <th><a href="#slide61">Inspecting the Instances' Log Files</a></th>
        <td><a href="#slide61">61</a></td>
      </tr>
      
      
      <tr id="toc-row-62">
        <th><a href="#slide62">By End of Thursday's Lab</a></th>
        <td><a href="#slide62">62</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>