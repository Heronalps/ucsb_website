<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Relational Databases: Concurrency Control and Query Analysis</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
      
      <link rel="stylesheet" href="theme/css/custom.css">
      
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    
    <!-- /Javascripts -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67332703-1', 'auto');
      ga('send', 'pageview');
    </script>
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide title slide-1">
          <div class="inner">
            
            <header><h1>Relational Databases: Concurrency Control and Query Analysis</h1></header>
            
            
            <section><p><strong>CS290B</strong></p>
<p>Dr. Bryce Boe</p>
<p>October 22, 2015</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              1/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-2">
          <div class="inner">
            
            <header><h1>Today's Agenda</h1></header>
            
            
            <section><ul>
<li>TODO</li>
<li>Server-side Caching in Rails Review</li>
<li>Motivation</li>
<li>A Stable Data Layer</li>
<li>Database Concurrency Control</li>
<li>Query Analysis</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              2/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-3">
          <div class="inner">
            
            <header><h1>TODO</h1></header>
            
            
            <section><h2>By end of lab</h2>
<ul>
<li>As a team, launch your application on AWS</li>
<li>Individually, confirm that you are able to SSH into your instance</li>
<li>Shutdown your AWS stack(s)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              3/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-4">
          <div class="inner">
            
            <header><h1>Server-side Caching in Rails Review</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              4/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-5">
          <div class="inner">
            
            <header><h1>Rails Russian Doll Caching</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="n">cache_key_for_submission_table</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"></span>

<span class="x">&lt;h3&gt;Submissions&lt;/h3&gt;</span>
<span class="x">&lt;table class=&quot;table&quot;&gt;</span>
<span class="x">  &lt;thead&gt;</span>
<span class="x">    &lt;tr&gt;...&lt;/tr&gt;</span>
<span class="x">  &lt;/thead&gt;</span>

<span class="x">  &lt;tbody&gt;</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="vi">@submissions</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">submission</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      </span><span class="cp">&lt;%</span> <span class="n">cache</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">do</span> <span class="cp">%&gt;</span><span class="x"> ... </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/tbody&gt;</span>
<span class="x">&lt;/table&gt;</span>

<span class="x">...</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              5/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-6">
          <div class="inner">
            
            <header><h1>Low-level Rails Caching</h1></header>
            
            
            <section><p>You can use the same built-in mechanisms to manually cache anything:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">competing_price</span>
    <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">/competing_price&quot;</span><span class="p">,</span>
                      <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">12</span><span class="o">.</span><span class="n">hours</span><span class="p">)</span> <span class="k">do</span>
      <span class="no">Competitor</span><span class="o">::</span><span class="no">API</span><span class="o">.</span><span class="n">find_price</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              6/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-7">
          <div class="inner">
            
            <header><h1>Motivation</h1></header>
            
            
            <section><p>After today you should...</p>
<ul>
<li>understand the importance of relational databases in architecting scalable
  Internet systems</li>
<li>understand how to design with concurrency in mind</li>
<li>have a basic idea regarding how to speed up your data layer<ul>
<li>where to start</li>
<li>Rails-specific techniques</li>
<li>be able to identity the source of slowness in a SQL query</li>
</ul>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              7/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-8">
          <div class="inner">
            
            <header><h1>Stateful Requests</h1></header>
            
            
            <section><p><img alt="Database connectivity" src="img/app_server_to_database.png" /></p>
<p>We have many stateless application servers responding to requests.</p>
<p>Clients can be served by any application servers.</p>
<p>Client requests regularly include data updates.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              8/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide has_code img-left slide-9">
          <div class="inner">
            
            <header><h1>Application Server <em>Needs</em></h1></header>
            
            
            <section><p><img alt="Database connectivity" src="img/app_server_to_database.png" /></p>
<ul>
<li>
<p>Data needs to be shared between requests and servers</p>
</li>
<li>
<p>Access to data shouldn't be slow</p>
</li>
<li>
<p>High availability of shared data</p>
</li>
<li>
<p>Utilizing the data layer should be intuitive:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">david</span><span class="o">.</span><span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">100</span>
  <span class="n">david</span><span class="o">.</span><span class="n">withdrawal</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">mary</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              9/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-10">
          <div class="inner">
            
            <header><h1>Data Layer Options</h1></header>
            
            
            <section><p><img alt="Database connectivity" src="img/app_server_to_database.png" /></p>
<p>There are quite a few existing solutions for a <em>stable</em> data layer.</p>
<h2>Relational (SQL)</h2>
<ul>
<li>MySQL (MariaDB, Percona)</li>
<li>Postgresql</li>
<li>Oracle</li>
<li>MS SQL</li>
</ul>
<h2>Non-relational (NoSQL)</h2>
<ul>
<li>Cassandra</li>
<li>MongoDB</li>
<li>Redis</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              10/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-11">
          <div class="inner">
            
            <header><h1>SQL v. NoSQL</h1></header>
            
            
            <section><p><img alt="Database connectivity" src="img/app_server_to_database.png" /></p>
<h2>Relational Databases...</h2>
<ul>
<li>are a general-purpose persistence layer</li>
<li>offer more features</li>
<li>have a limited ability to scale horizontally</li>
</ul>
<h2>Non-relational Databases...</h2>
<ul>
<li>often are more specialized</li>
<li>require more from the application layer</li>
<li>are better at scaling horizontally</li>
</ul>
<p>If your needs fit within a RDBMS's (relational database management system)
ability to scale, they tend to be best. If your scaling needs exceed RDBMS
capabilities, go non-relational.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              11/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-12">
          <div class="inner">
            
            <header><h1>Database Outline</h1></header>
            
            
            <section><p><img alt="Database connectivity" src="img/app_server_to_database.png" /></p>
<h2>Today we will discuss:</h2>
<ul>
<li>Relational databases</li>
<li>Concurrency control</li>
<li>SQL query analysis</li>
</ul>
<h2>Later we will discuss:</h2>
<ul>
<li>Scaling options for relational databases:<ul>
<li>Sharding</li>
<li>Service Oriented Architectures (SOA)</li>
<li>Distinguishing reads from writes</li>
</ul>
</li>
<li>A survey of NoSQL options</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              12/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-13">
          <div class="inner">
            
            <header><h1>Database Transactions</h1></header>
            
            
            <section><p>Transactions are a database concept that allows a system to guarantee certain
semantic properties.</p>
<p>Transactions provide control over concurrency.</p>
<p>Having rigorously defined guarantees means we can build correct systems using
these databases.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              13/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-14">
          <div class="inner">
            
            <header><h1>Database Transaction History</h1></header>
            
            
            <section><h2>Mid 1970's, IBM System R's Research Storage System (RSS)</h2>
<ul>
<li>First system to implement SQL</li>
<li>Introduced formal notions of transactions and serializability</li>
</ul>
<p>Jim Gray (1998 Turing Award Winner) had a significant role in the project for
the introduction of transactions.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              14/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-15">
          <div class="inner">
            
            <header><h1>Database ACID Properties</h1></header>
            
            
            <section><h2>Atomicity</h2>
<ul>
<li>Complete everything, or do nothing</li>
<li>No partial application of a transaction</li>
</ul>
<h2>Consistency</h2>
<ul>
<li>The database should be consistent both at the beginning and end of a
  transaction</li>
<li>Consistency is defined by the integrity constraints (e.g., foreign keys, <code>NOT
  NULL</code>, etc.)</li>
</ul>
<h2>Isolation</h2>
<ul>
<li>A transaction should not see the effects of other uncommitted transactions</li>
</ul>
<h2>Durability</h2>
<ul>
<li>Once committed, the transaction's effects should not disappear</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              15/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-16">
          <div class="inner">
            
            <header><h1>Overlapping Concerns</h1></header>
            
            
            <section><p><strong>Atomicity</strong> and <strong>Durability</strong> are related and are generally provided by
<em>journalling</em>.</p>
<p><strong>Consistency</strong> and <strong>Isolation</strong> are provided by concurrency control (usually
implemented via locking).</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              16/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide table-center slide-17">
          <div class="inner">
            
            <header><h1>Definition: Schedule</h1></header>
            
            
            <section><p>A <strong>schedule</strong> is an abstract model used to describe the execution of
transactions that run in a database.</p>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
<th align="center">T3</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">R(X)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">W(X)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Commit</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">R(Y)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">W(Y)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Commit</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">R(Z)</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">W(Z)</td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">Commit</td>
</tr>
</tbody>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              17/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-18">
          <div class="inner">
            
            <header><h1>Conflicting Actions</h1></header>
            
            
            <section><p>Two actions are said to be in conflict if:</p>
<ul>
<li>the actions belong to different transactions</li>
<li>at least one of the actions is a write operation</li>
<li>the actions access the same object (read or write)</li>
</ul>
<h2>Conflicting Actions</h2>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
<th align="center">T3</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">R(X)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">W(X)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">W(X)</td>
</tr>
</tbody>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              18/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide center slide-19">
          <div class="inner">
            
            <header><h1>Non-Conflicting Examples</h1></header>
            
            
            <section><h2>All reads</h2>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
<th align="center">T3</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">R(X)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">R(X)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">R(X)</td>
</tr>
</tbody>
</table>
<h2>Write to different object</h2>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
<th align="center">T3</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">R(X)</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">W(Y)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center">R(X)</td>
</tr>
</tbody>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              19/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-20">
          <div class="inner">
            
            <header><h1>Question</h1></header>
            
            
            <section><blockquote>
<p>Can we blindly execute transaction in parallel?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              20/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-21">
          <div class="inner">
            
            <header><h1>Answer</h1></header>
            
            
            <section><blockquote>
<p>Can we blindly execute transaction in parallel?</p>
</blockquote>
<p><strong>No</strong></p>
<ul>
<li>Dirty Read Problem</li>
<li>Incorrect Summary Problem</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              21/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide table-center slide-22">
          <div class="inner">
            
            <header><h1>Dirty Read Problem</h1></header>
            
            
            <section><p>A transaction (T2) reads a value written by another transaction (T1) that is
later <em>aborted</em> (its actions are rolledback).</p>
<p>The result of the T2 transaction will put the database in an incorrect state.</p>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">W(X)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">R(X)</td>
</tr>
<tr>
<td align="center">Abort</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">W(Y)</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Commit</td>
</tr>
</tbody>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              22/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide table-center slide-23">
          <div class="inner">
            
            <header><h1>Incorrect Summary Problem</h1></header>
            
            
            <section><p>A transaction (T1) computes a summary over the values of all the instances of a
repeated data-item. While that occurs, another transaction (T2) updates some
instances of data-item.</p>
<p>The resulting summary will not reflect a correct result for any deterministic
order of the transactions (T1 then T2, or T2 then T1).</p>
<table>
<thead>
<tr>
<th align="center">T1</th>
<th align="center">T2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">R(X*)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">R(X*)</td>
<td align="center">W(X^n)</td>
</tr>
<tr>
<td align="center">R(X*)</td>
<td align="center">Commit</td>
</tr>
<tr>
<td align="center">R(X*)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">W(Y)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Commit</td>
<td align="center"></td>
</tr>
</tbody>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              23/24
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 09_relational_databases_db_concurrency_and_query_analysis.md -->
      <div class="slide-wrapper">
        <div class="slide slide-24">
          <div class="inner">
            
            <header><h1>Schedule Types</h1></header>
            
            
            <section><h2>A schedule is <em>serial</em> if</h2>
<ul>
<li>the transctions are executed non-interleaved</li>
</ul>
<h2>Two schedules are <em>conflict equivalent</em> if</h2>
<ul>
<li>they involve the same actions of the same transactions</li>
<li>every pair of conflicting actions are ordered in the same way</li>
</ul>
<h2>A schedule is <em>conflict serializable</em> if</h2>
<ul>
<li>the schedule is <strong>conflict equivalent</strong> to a <strong>serial</strong> schedule</li>
</ul>
<h2>A schedule is <em>recoverable</em> if</h2>
<ul>
<li>transactions commit only after all transactions whose changes they read,
  commit</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="09_relational_databases_db_concurrency_and_query_analysis.md">09_relational_databases_db_concurrency_and_query_analysis.md</a>
            </aside>
            
            <aside class="page_number">
              24/24
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Relational Databases: Concurrency Control and Query Analysis</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">Today's Agenda</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">TODO</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Server-side Caching in Rails Review</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">Rails Russian Doll Caching</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Low-level Rails Caching</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Motivation</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Stateful Requests</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">Application Server <em>Needs</em></a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">Data Layer Options</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">SQL v. NoSQL</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Database Outline</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Database Transactions</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Database Transaction History</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Database ACID Properties</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">Overlapping Concerns</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">Definition: Schedule</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">Conflicting Actions</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">Non-Conflicting Examples</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Question</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">Answer</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">Dirty Read Problem</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">Incorrect Summary Problem</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">Schedule Types</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>