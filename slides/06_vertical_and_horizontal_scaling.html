<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Vertical and Horizontal Scaling</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
      
      <link rel="stylesheet" href="theme/css/custom.css">
      
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    
    <!-- /Javascripts -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67332703-1', 'auto');
      ga('send', 'pageview');
    </script>
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide title slide-1">
          <div class="inner">
            
            <header><h1>Vertical and Horizontal Scaling</h1></header>
            
            
            <section><p><strong>CS290B</strong></p>
<p>Dr. Bryce Boe</p>
<p>October 13, 2015</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              1/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-2">
          <div class="inner">
            
            <header><h1>Today's Agenda</h1></header>
            
            
            <section><ul>
<li>TODO</li>
<li>Server Architecture Review</li>
<li>Motivation</li>
<li>Vertical Scaling</li>
<li>Horizontal Scaling</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              2/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-3">
          <div class="inner">
            
            <header><h1>TODO</h1></header>
            
            
            <section><h2>Should be done</h2>
<ul>
<li>Ruby Codecademy</li>
<li>Agile Web Development with Rails Chapters 1 through 8</li>
<li>Familiarity with Git (you'll get more practice)</li>
<li><a href="http://www.ics.uci.edu/~cs230/reading/DLB.pdf">Dynamic Load Balancing on Web-server Systems</a>
  by Cardellini, Colajanni, and Yu.</li>
<li>Pivotal contains stories for the entire project</li>
<li>Github contains base-rails app (and more)</li>
</ul>
<h2>Before Lab</h2>
<ul>
<li>Agile Web Development with Rails Chapters 9 through 17</li>
<li>Make as much progress on Sprint 1 commitment as possible</li>
</ul>
<p><strong>Focus</strong>: On delivering new usable features to your customers (Seb and me) for
the next few weeks.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              3/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-4">
          <div class="inner">
            
            <header><h1>HTTP Server Architectures</h1></header>
            
            
            <section><ul>
<li>Single Threaded (no concurrency)</li>
<li>Process per request</li>
<li>Process pool</li>
<li>Thread per request</li>
<li>Process/thread worker pool</li>
<li>Event-driven</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              4/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-5">
          <div class="inner">
            
            <header><h1>What are the trade-offs of process-based concurrency?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              5/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-6">
          <div class="inner">
            
            <header><h1>What are the trade-offs of thread-based concurrency?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              6/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-7">
          <div class="inner">
            
            <header><h1>What are the trade-offs of event-driven systems?</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              7/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-8">
          <div class="inner">
            
            <header><h1>Scaling Goal</h1></header>
            
            
            <section><p><img alt="Load Balanced Topology" src="img/load_balanced_topology.png" /></p>
<p>After today you will understand what load balancing is, and why the depicted
architecture provides smooth cost-effective scaling.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              8/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-9">
          <div class="inner">
            
            <header><h1>The Problem</h1></header>
            
            
            <section><p>You've built something the world (or significant subset) is excited about.</p>
<blockquote>
<p>What do you do when your popularity doubles (again, and again)?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              9/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-10">
          <div class="inner">
            
            <header><h1>The Solutions</h1></header>
            
            
            <section><h2>Vertical Scaling</h2>
<p>Buying "bigger" hardware and scaling <em>up</em></p>
<ul>
<li><strong>PRO</strong>: Easy</li>
<li><strong>CON</strong>: Limited</li>
<li><strong>CON</strong>: Non-linear increase in cost when scaling</li>
</ul>
<h2>Horizontal Scaling</h2>
<p>Buying move servers and scaling <em>out</em></p>
<ul>
<li><strong>PRO</strong>: Easy to add more servers (limited by data center space)</li>
<li><strong>PRO</strong>: Linear increase in cost when scaling</li>
<li><strong>CON</strong>: More moving parts makes things more complicated</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              10/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-11">
          <div class="inner">
            
            <header><h1>Vertical Scaling</h1></header>
            
            
            <section><p>When needed, increase the resources of your current server, eventually buy a
bigger server with:</p>
<ul>
<li>More memory</li>
<li>More and/or faster CPUs and/or cores</li>
<li>Higher bandwidth</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              11/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-12">
          <div class="inner">
            
            <header><h2>EC2 and Vertical Scaling</h2></header>
            
            
            <section><p>With Amazon EC2 you rent virtual instances. There are clear vertical scaling
paths. Each type of instance (below) has a few options ranging from lower
resources/performance to higher resources/performance:</p>
<ul>
<li><strong>T</strong> and <strong>M</strong> prefixed instances: balanced mix of memory and CPU</li>
<li><strong>C</strong> prefixed instances: CPU optimized</li>
<li><strong>R</strong> prefixed instances: Memory optimized</li>
<li><strong>G</strong> prefixed instances: GPU optimized</li>
<li><strong>I</strong> prefixed instances: I/O optimized</li>
<li><strong>D</strong> prefixed instances: Storage capacity optimized</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              12/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-13">
          <div class="inner">
            
            <header><h1>Scaling Test: Simulated Users</h1></header>
            
            
            <section><p>We will use the same test setup explained in the last lecture.</p>
<p>Using Tsung (erlang-based test framework) we will simulate multiple users
visiting the Demo App web service. Each user will:</p>
<pre><code>Visit the homepage (/)
  Wait randomly between 0 and 2 seconds
Request community creation form
  Wait randomly between 0 and 2 seconds
Submit new community form
Request new link submission form
  Wait randomly between 0 and 2 seconds
Submit new link submission form
  Wait randomly between 0 and 2 seconds
Delete the link
  Wait randomly between 0 and 2 seconds
Delete the community
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              13/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-14">
          <div class="inner">
            
            <header><h1>Scaling Test: Phases</h1></header>
            
            
            <section><p>This time we have twelve phases of testing each lasting 60 seconds:</p>
<pre><code> 1.    (0-59s) Every second a new simulated user arrives
 2.  (60-119s) Every second 1.5 new simulated users arrive
 3. (120-179s) Every second 2 new simulated users arrive
 4. (180-239s) Every second 4 new simulated users arrive
 5. (240-299s) Every second 6 new simulated users arrive
 6. (300-359s) Every second 10 new simulated users arrive
 7. (360-419s) Every second 16 new simulated users arrive
 8. (420-479s) Every second 20 new simulated users arrive
 9. (480-539s) Every second 25 new simulated users arrive
10. (540-599s) Every second 35 new simulated users arrive
11. (600-659s) Every second 45 new simulated users arrive
12. (660-719s) Every second 55 new simulated users arrive
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              14/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-15">
          <div class="inner">
            
            <header><h1>Vertical Scaling: M3 Large Instance</h1></header>
            
            
            <section><p><img alt="M3 Large Instance Graph" src="img/vertical_scaling_m3_large.png" /></p>
<ul>
<li>2 vCPUs</li>
<li>7.5 GB Memory</li>
<li>SSD storage</li>
<li>$100 per month</li>
</ul>
<p>Handles 6 new users per second (ups).</p>
<p>Fails with 10 ups.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              15/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-16">
          <div class="inner">
            
            <header><h1>Vertical Scaling: M3 X-Large Instance</h1></header>
            
            
            <section><p><img alt="M3 X-Large Instance Graph" src="img/vertical_scaling_m3_xlarge.png" /></p>
<ul>
<li>4 vCPUs</li>
<li>15 GB Memory</li>
<li>SSD storage</li>
<li>$200 per month</li>
</ul>
<p>Handles 10 new users per second (ups).</p>
<p>Fails with 16 ups.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              16/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-17">
          <div class="inner">
            
            <header><h1>Vertical Scaling: M3 XX-Large Instance</h1></header>
            
            
            <section><p><img alt="M3 XX-Large Instance Graph" src="img/vertical_scaling_m3_xxlarge.png" /></p>
<ul>
<li>8 vCPUs</li>
<li>30 GB Memory</li>
<li>SSD storage</li>
<li>$400 per month</li>
<li>Largest available M-prefixed instance.</li>
</ul>
<p>Handles 16 new users per second (ups).</p>
<p>Fails with 20 ups.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              17/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-18">
          <div class="inner">
            
            <header><h1>Vertical Scaling: C3 4XLarge Instance</h1></header>
            
            
            <section><p><img alt="C3 4XLarge Instance Graph" src="img/vertical_scaling_c3_4xlarge.png" /></p>
<ul>
<li>16 vCPUs</li>
<li>30 GB Memory</li>
<li>SSD storage</li>
<li>$600 per month</li>
</ul>
<p>Handles 20 new users per second (ups).</p>
<p>Fails with 25 ups.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              18/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-19">
          <div class="inner">
            
            <header><h1>Load Balancing</h1></header>
            
            
            <section><p>Vertical scaling has its place, but horizontal scaling is generally preferable.</p>
<p>When horizontally scaling HTTP, this technique is referred to as <strong>load
balancing</strong>.</p>
<h2>Basic Idea</h2>
<ul>
<li>Have many servers that can server clients</li>
<li>Make these servers <em>appear</em> as single endpoint to the outside world</li>
</ul>
<p>The users' experiences are the same regardless of which server ultimately
handles the request.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              19/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-20">
          <div class="inner">
            
            <header><h1>Think About It</h1></header>
            
            
            <section><blockquote>
<p>How can we enable many servers to serve clients?</p>
</blockquote>
<p>Consider the following sequence of actions:</p>
<ol>
<li>GET /products</li>
<li>POST /products</li>
<li>GET /products</li>
</ol>
<blockquote>
<p>If these requests are handled by three different servers, will the third
request show the new product?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              20/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-21">
          <div class="inner">
            
            <header><h1>Stateless Servers</h1></header>
            
            
            <section><p><img alt="Load Balanced Topology" src="img/load_balanced_topology.png" /></p>
<p>In order for load balancing to work, the servers must be stateless.</p>
<p>Statelessness can be accomplished by keeping the persistence layer separate
from the application layer.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              21/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-22">
          <div class="inner">
            
            <header><h1>Load Balancing (1): HTTP Redirects</h1></header>
            
            
            <section><p><img alt="Load balancing via redirect" src="img/load_balancing_redirect.png" /></p>
<p>Discussed in section 6.1 of the reading.</p>
<p>Implemented using multiple web servers with different domain names.</p>
<p>A request for www.domain.com will use HTTP 301 or 302 to redirect the request
to a pool of possible hosts.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              22/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide has_code slide-23">
          <div class="inner">
            
            <header><h1>HTTP Redirect Example</h1></header>
            
            
            <section><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="err">% nc www.domain.com 80</span>
<span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">host</span><span class="o">:</span> <span class="l">www.domain.com</span>

HTTP/1.1 301 Moved Permanently
Date: Wed, 15 Oct 2014 21:08:22 GMT
Server: Apache/2.2.22 (Ubuntu)
Location: http://www2.domain.com/
Content-Type: text/html; charset=iso-8859-1
...
</pre></div>
</td></tr></table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              23/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-24">
          <div class="inner">
            
            <header><h1>HTTP Redirects Trade-offs</h1></header>
            
            
            <section><h2>Strengths</h2>
<ul>
<li>Simple</li>
<li>Complete control over load balancing algorithm</li>
<li>Location independent</li>
</ul>
<h2>Weaknesses</h2>
<ul>
<li>Not transparent to user</li>
<li>High load on www</li>
<li>May reduce local-network cache applicability</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              24/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-25">
          <div class="inner">
            
            <header><h1>Load Balancing (2): Round Robin DNS</h1></header>
            
            
            <section><p><img alt="Load balancing via round-robin DNS" src="img/load_balancing_round_robin.png" /></p>
<p>Discussed in section 4.1 of the reading.</p>
<p>When user's browser queries DNS for www.example.com, a list of IPs is
returned. The DNS server rotates the list order for each query (or alters
priorities).</p>
<p>User's browser chooses which IP to connect to (generally picks the first, or
highest priority).</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              25/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-26">
          <div class="inner">
            
            <header><h1>Round Robin DNS Example</h1></header>
            
            
            <section><pre><code>% host www.google.com
www.google.com has address 74.125.224.48
www.google.com has address 74.125.224.51
www.google.com has address 74.125.224.52
www.google.com has address 74.125.224.49
www.google.com has address 74.125.224.50

% host www.google.com
www.google.com has address 74.125.224.49
www.google.com has address 74.125.224.52
www.google.com has address 74.125.224.51
www.google.com has address 74.125.224.50
www.google.com has address 74.125.224.48
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              26/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-27">
          <div class="inner">
            
            <header><h1>Round Robin DNS Trade-offs</h1></header>
            
            
            <section><h2>Strengths</h2>
<ul>
<li>Simple</li>
<li>Cheap</li>
</ul>
<h2>Weaknesses</h2>
<ul>
<li>Less control over balancing</li>
<li>Modifying the list is inhibited by caching in the browser and proxies</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              27/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-28">
          <div class="inner">
            
            <header><h1>Load Balancing (3): TCP Load Balancing</h1></header>
            
            
            <section><p><img alt="Load balancing via TCP" src="img/load_balancing_tcp.png" /></p>
<p>Discussed in section 5 of the reading.</p>
<h2>General Idea</h2>
<p>Rewrite TCP packets to send them to the selected server. This includes
addresses, sequence numbers, and checksums.</p>
<h2>Commercial Products (use hardware ASICs to do this fast)</h2>
<ul>
<li>Cisco Content Services Switch</li>
<li>Citrix Netscaler</li>
<li>F5 Big IP</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              28/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-29">
          <div class="inner">
            
            <header><h1>TCP Load Balancing Example 1</h1></header>
            
            
            <section><p>__ client -&gt; switch : 216.64.159.149 -&gt; 208.50.157.136
IP D=208.50.157.136 S=216.64.159.149 LEN=60, ID=48397 2.94950 216.64.159.149 -&gt; 208.50.157.136
TCP D=80 S=1421 Syn Seq=899863543 Len=0 Win=32120 …</p>
<p>__ switch -&gt; client : 208.50.157.136 -&gt; 216.64.159.149
IP D=216.64.159.149 S=208.50.157.136 LEN=48, ID=26291 2.95125 208.50.157.136 -&gt; 216.64.159.149
TCP D=1421 S=80 Syn Ack=899863544 Seq=1908949446 Len=0 ...</p>
<p>__ client -&gt; switch : 216.64.159.149 -&gt; 208.50.157.136
IP D=208.50.157.136 S=216.64.159.149 LEN=40, ID=48400 2.98324 216.64.159.149 -&gt; 208.50.157.136
TCP D=80 S=1421 Ack=1908949447 Seq=899863544 Len=0 ...</p>
<p>__ client -&gt; switch : 216.64.159.149 -&gt; 208.50.157.136
IP D=208.50.157.136 S=216.64.159.149 LEN=154, ID=48401 2.98395 216.64.159.149 -&gt; 208.50.157.136
TCP D=80 S=1421 Ack=1908949447 Seq=899863544 Len=114 ... 2.98395 216.64.159.149 -&gt; 208.50.157.136
HTTP GET /eb/images/ec_home_logo_tag.gif HTTP/1.0</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              29/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-30">
          <div class="inner">
            
            <header><h1>TCP Load Balancing Example 2</h1></header>
            
            
            <section><p>__ switch -&gt; server : 216.64.159.149 -&gt; 10.16.100.121
IP D=10.16.100.121 S=216.64.159.149 LEN=48, ID=26292 0.00000 216.64.159.149 -&gt; 10.16.100.121
TCP D=80 S=1421 Syn Seq=899863543 Len=0 Win=32120 Options...</p>
<p>__ server -&gt; switch : 10.16.100.121 -&gt; 216.64.159.149
IP D=216.64.159.149 S=10.16.100.121 LEN=44, ID=22235 0.00001 10.16.100.121 -&gt; 216.64.159.149
TCP D=1421 S=80 Syn Ack=899863544 Seq=2156657894 Len=0 ...</p>
<p>__ switch -&gt; server : 216.64.159.149 -&gt; 10.16.100.121
IP D=10.16.100.121 S=216.64.159.149 LEN=154, ID=48401 0.00131 216.64.159.149 -&gt; 10.16.100.121
TCP D=80 S=1421 Ack=2156657895 Seq=899863544 Len=114 ... 0.00131 216.64.159.149 -&gt; 10.16.100.121
HTTP GET /eb/images/ec_home_logo_tag.gif HTTP/1.0</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              30/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-31">
          <div class="inner">
            
            <header><h1>TCP Load Balancing Example 3</h1></header>
            
            
            <section><p>__ server -&gt; switch : 10.16.100.121 -&gt; 216.64.159.149
IP D=216.64.159.149 S=10.16.100.121 LEN=40, ID=22236 0.00134 10.16.100.121 -&gt; 216.64.159.149
TCP D=1421 S=80 Ack=899863658 Seq=2156657895 Len=0 …</p>
<p>__ switch -&gt; client : 208.50.157.136 -&gt; 216.64.159.149
IP D=216.64.159.149 S=208.50.157.136 LEN=40, ID=22236 2.98619 208.50.157.136 -&gt; 216.64.159.149
TCP D=1421 S=80 Ack=899863658 Seq=1908949447 Len=0 ...</p>
<p>__ server -&gt; switch : 10.16.100.121 -&gt; 216.64.159.149
IP D=216.64.159.149 S=10.16.100.121 LEN=1500, ID=22237 0.00298 10.16.100.121 -&gt; 216.64.159.149
TCP D=1421 S=80 Ack=899863658 Seq=2156657895 Len=1460 ... 0.00298 10.16.100.121 -&gt; 216.64.159.149
HTTP HTTP/1.1 200 OK</p>
<p>__ switch -&gt; client : 208.50.157.136 -&gt; 216.64.159.149
IP D=216.64.159.149 S=208.50.157.136 LEN=1500, ID=22237 2.98828 208.50.157.136 -&gt; 216.64.159.149
TCP D=1421 S=80 Ack=899863658 Seq=1908949447 Len=1460 ... 2.98828 208.50.157.136 -&gt; 216.64.159.149
HTTP HTTP/1.1 200 OK</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              31/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-32">
          <div class="inner">
            
            <header><h1>TCP Load Balancing Trade-offs</h1></header>
            
            
            <section><h2>Strengths</h2>
<ul>
<li>More control over which requests go to which servers</li>
<li>Works fine with HTTPs</li>
</ul>
<h2>Weaknesses</h2>
<ul>
<li>Constrains where the servers can be located (same network)</li>
<li>Complicated</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              32/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-33">
          <div class="inner">
            
            <header><h1>Load Balancing (4): HTTP Proxy</h1></header>
            
            
            <section><p><img alt="Load balancing via TCP" src="img/load_balancing_http_proxy.png" /></p>
<p>Also known as "Layer 6 load balancing"</p>
<p>Terminate HTTP requests: act like a web server</p>
<p>Issue <em>back-end</em> HTTP request to the desired application server.</p>
<p>Hardware products:</p>
<ul>
<li>Citrix Netscaler</li>
<li>F5 Big-IP</li>
</ul>
<p>Many HTTP servers have modules to do this as well (Apache, NGINX)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              33/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-34">
          <div class="inner">
            
            <header><h1>HTTP Proxy Trade-offs</h1></header>
            
            
            <section><p>This is the most popular technique in use (#3 is also used).</p>
<h2>Strengths</h2>
<ul>
<li>Cleaner implementation than packet rewriting</li>
</ul>
<h2>Weaknesses</h2>
<ul>
<li>Load balancer needs to do more work</li>
<li>HTTPs is more complicated</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              34/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-35">
          <div class="inner">
            
            <header><h1>Think About It</h1></header>
            
            
            <section><p>Assume you are to design a load balancing HTTP proxy. You have insight into
every incoming request and response.</p>
<blockquote>
<p>How would you determine which server to forward a request to?</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              35/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-36">
          <div class="inner">
            
            <header><h1>Load Balancing Considerations</h1></header>
            
            
            <section><blockquote>
<p>How would you determine which server to forward a request to?</p>
</blockquote>
<h2>Options</h2>
<ul>
<li>Random</li>
<li>Round robin</li>
<li>Least number of connections</li>
<li>Fastest response time</li>
<li>Bandwidth per server</li>
<li>URI-based mapping (e.g., <code>/images</code> to server1, <code>/admin</code> to server2)</li>
</ul>
<p>Amazon's ELB (elastic load balancer) uses round robin with cookie-based
stickiness (send the same client to the same server).</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              36/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-37">
          <div class="inner">
            
            <header><h1>Load Balancing Challenges</h1></header>
            
            
            <section><p>When working with and/or designing a load balancing proxy there are some
challenges to consider.</p>
<ul>
<li>Detecting and reacting to server failures</li>
<li>Session affinity and persistence</li>
<li>Connection pooling</li>
</ul>
<p><strong>Affinity</strong>: Map a client to a server without application-level information
(e.g., IP address, request time)</p>
<p><strong>Persistence</strong>: Use application-level
information to map a client to a server (e.g., cookies)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              37/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-38">
          <div class="inner">
            
            <header><h1>Detecting Server Failures</h1></header>
            
            
            <section><blockquote>
<p>How do we know when a member of our application pool has died?</p>
</blockquote>
<p>Observe traffic. Are requests being processed? Are they just taking a long
time?</p>
<p>Probe the server through various means:</p>
<ul>
<li><strong>ICMP ping</strong>: tests the network and server kernel</li>
<li><strong>TCP connection</strong>: the process is running and accepting connections</li>
<li><strong>HTTP HEAD</strong>: the application is serving pages</li>
<li><strong>SNMP</strong>: Provides insight into server load (and more if configured)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              38/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-39">
          <div class="inner">
            
            <header><h1>Session Affinity and Persistence</h1></header>
            
            
            <section><blockquote>
<p>Can we redirect users back to the same web server they used before?</p>
</blockquote>
<p>Doing so can provide some caching improvements.</p>
<p>A few options:</p>
<ul>
<li>Affinity based on client IP address (concerns: client IPs change, and IPs are
shared)</li>
<li>HTTP Cookie (works but requires proxy configuration)</li>
<li>Session ID in URL (not a great solution)</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              39/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-40">
          <div class="inner">
            
            <header><h1>Connection Pooling</h1></header>
            
            
            <section><p>We're used to the idea that one client reuses a TCP connection for many HTTP
requests.</p>
<p>We can reuse this mechanism for distinct clients.</p>
<p>Saves on repeated TCP setup between the load balancer and application servers.</p>
<p>Reduces idle waiting on server for reads and writes.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              40/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-41">
          <div class="inner">
            
            <header><h1>Software Load Balancers</h1></header>
            
            
            <section><ul>
<li>Apache</li>
<li>NGINX</li>
<li>HAProxy</li>
<li>Varnish</li>
<li>Pound</li>
<li>Squid</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              41/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-42">
          <div class="inner">
            
            <header><h1>Amazon Elastic Load Balancer</h1></header>
            
            
            <section><p>Amazon provides load balancing as a service.</p>
<ul>
<li>$0.025 per load balancer hour</li>
<li>$0.008 per GB of data processed</li>
<li>Works with EC2 autoscaling groups</li>
<li>Supports TLS termination</li>
<li>Supports load balancing between Availability Zones within a Region</li>
</ul>
<p><strong>Does not</strong>: support load balancing between regions (e.g., between us-west-1
and us-west-2). Consider using route 54 DNS for region failover.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              42/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-43">
          <div class="inner">
            
            <header><h1>Horizontal Scaling Test</h1></header>
            
            
            <section><p>In the vertical scaling tests, the database application ran on the same machine
as the web server application.</p>
<p>For these tests we are going to use a single machine for the database. This
will make it easy to scale up the number of application servers.</p>
<p><img alt="Single Server Load Balanced Topology" src="img/load_balanced_topology_single.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              43/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-44">
          <div class="inner">
            
            <header><h1>Horizontal Scaling: 1 M3 Large Instance</h1></header>
            
            
            <section><p><img alt="Single M3 Large Instance Graph" src="img/horizontal_scaling_1.png" /></p>
<ul>
<li>2 vCPUs</li>
<li>7.5 GB Memory</li>
<li>SSD storage</li>
<li>DB is also M3 large</li>
<li>$200 per month ($100 each)</li>
</ul>
<p>Handles 10 new users per second (ups).</p>
<p>Fails with 16 ups.</p>
<p>Comparable to single M3 XLarge ($200/mo)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              44/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-45">
          <div class="inner">
            
            <header><h1>Adding an App Server</h1></header>
            
            
            <section><p>Let's scale horizontally by adding a second application server instance.</p>
<p><img alt="Dual Server Load Balanced Topology" src="img/load_balanced_topology_double.png" /></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              45/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-46">
          <div class="inner">
            
            <header><h1>Horizontal Scaling: 2 M3 Large Instances</h1></header>
            
            
            <section><p><img alt="Dual M3 Large Instance Graph" src="img/horizontal_scaling_2.png" /></p>
<ul>
<li>2 vCPUs</li>
<li>7.5 GB Memory</li>
<li>SSD storage</li>
<li>DB is also M3 large</li>
<li>$300 per month ($100 each)</li>
</ul>
<p>Handles 20 new users per second (ups).</p>
<p>Fails with 25 ups.</p>
<p>Comparable to single C3 4XLarge ($600/mo)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              46/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-47">
          <div class="inner">
            
            <header><h1>More App Servers!</h1></header>
            
            
            <section><p><img alt="5x Load Balanced Topology" src="img/load_balanced_topology_5x.png" /></p>
<p>Let’s see how the system performs if we scale out to 5 app servers.</p>
<p>Total dollar cost will be comparable to the most expensive single instance we
tested.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              47/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide img-left slide-48">
          <div class="inner">
            
            <header><h1>Horizontal Scaling: 5 M3 Large Instances</h1></header>
            
            
            <section><p><img alt="Five M3 Large Instance Graph" src="img/horizontal_scaling_5.png" /></p>
<ul>
<li>2 vCPUs</li>
<li>7.5 GB Memory</li>
<li>SSD storage</li>
<li>DB is also M3 large</li>
<li>$600 per month ($100 each)</li>
</ul>
<p>Handles 35 new users per second (ups).</p>
<p>Handles 45 ups with an increase in response time.</p>
<p>Fails with 55 ups.</p>
<p>Single C3 4XLarge ($600/mo) failed at 25 ups!</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              48/49
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: 06_vertical_and_horizontal_scaling.md -->
      <div class="slide-wrapper">
        <div class="slide slide-49">
          <div class="inner">
            
            <header><h1>Horizontal Scaling FTW!</h1></header>
            
            
            <section><p>Vertical scaling handled only 20 new users per second at a cost of about $600
per month. There was no clear scaling path after that point.</p>
<p>Horizontal scaling handled 45 new users per second at a cost of about $600 per
month. The scaling path is clear. Add more servers for a linear increase in
cost.</p>
<p><em>FTW</em>: For the Win</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="06_vertical_and_horizontal_scaling.md">06_vertical_and_horizontal_scaling.md</a>
            </aside>
            
            <aside class="page_number">
              49/49
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Vertical and Horizontal Scaling</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">Today's Agenda</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">TODO</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">HTTP Server Architectures</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">What are the trade-offs of process-based concurrency?</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">What are the trade-offs of thread-based concurrency?</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">What are the trade-offs of event-driven systems?</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">Scaling Goal</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">The Problem</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">The Solutions</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Vertical Scaling</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
        
        <tr id="toc-row-12" class="sub">
          <th><a href="#slide12">EC2 and Vertical Scaling</a></th>
          <td><a href="#slide12">12</a></td>
        </tr>
        
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Scaling Test: Simulated Users</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Scaling Test: Phases</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Vertical Scaling: M3 Large Instance</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">Vertical Scaling: M3 X-Large Instance</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">Vertical Scaling: M3 XX-Large Instance</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">Vertical Scaling: C3 4XLarge Instance</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">Load Balancing</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Think About It</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">Stateless Servers</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">Load Balancing (1): HTTP Redirects</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">HTTP Redirect Example</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">HTTP Redirects Trade-offs</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">Load Balancing (2): Round Robin DNS</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">Round Robin DNS Example</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">Round Robin DNS Trade-offs</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">Load Balancing (3): TCP Load Balancing</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">TCP Load Balancing Example 1</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">TCP Load Balancing Example 2</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">TCP Load Balancing Example 3</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">TCP Load Balancing Trade-offs</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">Load Balancing (4): HTTP Proxy</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide34">HTTP Proxy Trade-offs</a></th>
        <td><a href="#slide34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide35">Think About It</a></th>
        <td><a href="#slide35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide36">Load Balancing Considerations</a></th>
        <td><a href="#slide36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide37">Load Balancing Challenges</a></th>
        <td><a href="#slide37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide38">Detecting Server Failures</a></th>
        <td><a href="#slide38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide39">Session Affinity and Persistence</a></th>
        <td><a href="#slide39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide40">Connection Pooling</a></th>
        <td><a href="#slide40">40</a></td>
      </tr>
      
      
      <tr id="toc-row-41">
        <th><a href="#slide41">Software Load Balancers</a></th>
        <td><a href="#slide41">41</a></td>
      </tr>
      
      
      <tr id="toc-row-42">
        <th><a href="#slide42">Amazon Elastic Load Balancer</a></th>
        <td><a href="#slide42">42</a></td>
      </tr>
      
      
      <tr id="toc-row-43">
        <th><a href="#slide43">Horizontal Scaling Test</a></th>
        <td><a href="#slide43">43</a></td>
      </tr>
      
      
      <tr id="toc-row-44">
        <th><a href="#slide44">Horizontal Scaling: 1 M3 Large Instance</a></th>
        <td><a href="#slide44">44</a></td>
      </tr>
      
      
      <tr id="toc-row-45">
        <th><a href="#slide45">Adding an App Server</a></th>
        <td><a href="#slide45">45</a></td>
      </tr>
      
      
      <tr id="toc-row-46">
        <th><a href="#slide46">Horizontal Scaling: 2 M3 Large Instances</a></th>
        <td><a href="#slide46">46</a></td>
      </tr>
      
      
      <tr id="toc-row-47">
        <th><a href="#slide47">More App Servers!</a></th>
        <td><a href="#slide47">47</a></td>
      </tr>
      
      
      <tr id="toc-row-48">
        <th><a href="#slide48">Horizontal Scaling: 5 M3 Large Instances</a></th>
        <td><a href="#slide48">48</a></td>
      </tr>
      
      
      <tr id="toc-row-49">
        <th><a href="#slide49">Horizontal Scaling FTW!</a></th>
        <td><a href="#slide49">49</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>